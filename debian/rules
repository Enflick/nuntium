#!/usr/bin/make -f
# -*- makefile -*-

export DH_OPTIONS
export DH_GOPKG := launchpad.net/nuntium
export DH_GOLANG_INSTALL_ALL := 1

DEB_HOST_ARCH := $(shell dpkg-architecture -qDEB_HOST_ARCH)

%:
	dh $@ \
		--buildsystem=golang \
		--with=golang \
		--fail-missing

override_dh_auto_test:
# The test runners panic when running on powerpc64.
ifneq ($(DEB_HOST_ARCH),powerpc)
	dh_auto_test
endif
	
override_dh_auto_install:
	dh_auto_install -O--buildsystem=golang
	mv ${CURDIR}/debian/tmp/usr/bin/decode-cli \
		${CURDIR}/debian/tmp/usr/bin/nuntium-decode-cli 
	rm -r \
		${CURDIR}/debian/tmp/usr/bin/test \
		${CURDIR}/debian/tmp/usr/share/gocode/src/$(DH_GOPKG)/test \
		${CURDIR}/debian/tmp/usr/share/gocode/src/$(DH_GOPKG)/storage \
		${CURDIR}/debian/tmp/usr/share/gocode/src/$(DH_GOPKG)/*.go

override_dh_strip:
	echo "Skipping strip"
